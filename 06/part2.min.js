i=require('fs').readFileSync(0,'utf8')

d='^>v<';l=i.indexOf`\n`+1;m=[-l,1,l,-1];f='%';F='#';V=[...i];r=g=>{S=P=-1;while(1){p=[0,1,2,3].find(x=>g.includes(d[x])),L=g.indexOf(d[p]),z=g[m[p]+L];if(z=='.'){S=L;P=p}if(p==P&S==L&z==f)return 1;g[L]=f;if(z==F)g[L]=d[(1 + p) % 4];else if(!z||z=='\n')break;else g[m[p]+L]=d[p]}}r(V,1)console.log(V.reduce((o,q,I)=>q!=f?o:(g=[...i],g[I]=F,o+(r(g,0)|0)),0))
